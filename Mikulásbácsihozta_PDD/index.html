<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Szélesbálási — Fedettpályás Kalaplengető Verseny</title>
    <style>
        body{font-family:Segoe UI,Roboto,Arial;background:#f7f9fc;color:#222;margin:20px}
        header{margin-bottom:12px}
        h1{margin:0;font-size:1.4rem}
        p{margin:4px 0 12px;color:#444}
        .controls{margin-bottom:10px}
        table{width:100%;border-collapse:collapse;background:#fff;box-shadow:0 0 0 1px #e2e8f0}
        th,td{padding:8px 10px;border:1px solid #e6eef7;text-align:center;font-size:0.95rem}
        th{background:#f1f6fb}
        input[type="text"], input[type="number"]{width:100%;box-sizing:border-box;padding:6px;border:1px solid #cbd7ea;border-radius:4px}
        button{padding:6px 10px;border-radius:6px;border:1px solid #2b6cb0;background:#3182ce;color:#fff;cursor:pointer}
        button.secondary{background:#4a5568;border-color:#4a5568}
        .small{font-size:0.85rem;padding:5px 8px}
    </style>
</head>
<body>
    <header>
        <h1>Szélesbálási — Fedettpályás Kalaplengető Verseny</h1>
        <p>Versenyzők listája és eredmények. Töltsd ki a pontokat és/időket, majd kattints a "Rangsor újraszámolása" gombra.</p>
    </header>

    <div class="controls">
        <button id="addBtn">Add versenyző</button>
        <button id="recalcBtn" class="secondary">Rangsor újraszámolása</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Név</th>
                <th>Pillanatnyi helyezés</th>
                <th>Pont1</th>
                <th>Idő1 (s)</th>
                <th>Pont2</th>
                <th>Idő2 (s)</th>
                <th>Pont3</th>
                <th>Idő3 (s)</th>
                <th>Legjobb pont</th>
                <th>Legjobb idő</th>
                <th>Akció</th>
            </tr>
        </thead>
        <tbody id="contestants">
            <!-- példa sor -->
            <tr>
                <td><input type="text" class="name" value="Kovács Ádám" /></td>
                <td class="rank">—</td>
                <td><input type="number" class="p" step="1" min="0" value="7" /></td>
                <td><input type="number" class="t" step="0.01" min="0" value="3.42" /></td>
                <td><input type="number" class="p" step="1" min="0" value="5" /></td>
                <td><input type="number" class="t" step="0.01" min="0" value="3.80" /></td>
                <td><input type="number" class="p" step="1" min="0" value="8" /></td>
                <td><input type="number" class="t" step="0.01" min="0" value="3.10" /></td>
                <td class="best-point">8</td>
                <td class="best-time">3.10</td>
                <td><button class="remove small">Töröl</button></td>
            </tr>
        </tbody>
    </table>

    <script>
        const tbody = document.getElementById('contestants');
        const addBtn = document.getElementById('addBtn');
        const recalcBtn = document.getElementById('recalcBtn');

        function makeRow(name='', p1='', t1='', p2='', t2='', p3='', t3=''){
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><input type="text" class="name" value="${name}" /></td>
                <td class="rank">—</td>
                <td><input type="number" class="p" step="1" min="0" value="${p1}" /></td>
                <td><input type="number" class="t" step="0.01" min="0" value="${t1}" /></td>
                <td><input type="number" class="p" step="1" min="0" value="${p2}" /></td>
                <td><input type="number" class="t" step="0.01" min="0" value="${t2}" /></td>
                <td><input type="number" class="p" step="1" min="0" value="${p3}" /></td>
                <td><input type="number" class="t" step="0.01" min="0" value="${t3}" /></td>
                <td class="best-point">—</td>
                <td class="best-time">—</td>
                <td><button class="remove small">Töröl</button></td>
            `;
            attachRowListeners(tr);
            return tr;
        }

        function attachRowListeners(tr){
            tr.querySelectorAll('input').forEach(inp=>{
                inp.addEventListener('input', ()=> updateRowBest(tr));
            });
            tr.querySelector('.remove').addEventListener('click', ()=>{
                tr.remove();
            });
            updateRowBest(tr);
        }

        function updateRowBest(tr){
            const p = Array.from(tr.querySelectorAll('.p')).map(i=>parseFloat(i.value)).filter(v=>!isNaN(v));
            const t = Array.from(tr.querySelectorAll('.t')).map(i=>parseFloat(i.value)).filter(v=>!isNaN(v));
            const bestPoint = p.length ? Math.max(...p) : '—';
            const bestTime = t.length ? Math.min(...t).toFixed(2) : '—';
            tr.querySelector('.best-point').textContent = bestPoint;
            tr.querySelector('.best-time').textContent = bestTime;
        }

        addBtn.addEventListener('click', ()=>{
            const newRow = makeRow('Új versenyző','','','','','','','');
            tbody.appendChild(newRow);
            newRow.querySelector('.name').focus();
        });

        recalcBtn.addEventListener('click', ()=>{
            // update all best values first
            Array.from(tbody.rows).forEach(r=>updateRowBest(r));
            // build array for sorting
            const rows = Array.from(tbody.rows);
            const mapped = rows.map(r=>{
                const bp = parseFloat(r.querySelector('.best-point').textContent);
                const bt = parseFloat(r.querySelector('.best-time').textContent);
                return {
                    row: r,
                    bp: isNaN(bp) ? -Infinity : bp,
                    bt: isNaN(bt) ? Infinity : bt
                };
            });
            mapped.sort((a,b)=>{
                if (b.bp !== a.bp) return b.bp - a.bp; // pont csökkenő
                return a.bt - b.bt; // idő növekvő (kisebb jobb)
            });
            // reorder DOM and set rankings
            mapped.forEach((m,i)=>{
                tbody.appendChild(m.row);
                m.row.querySelector('.rank').textContent = (isFinite(m.bp) ? (i+1) : '—');
            });
        });

        // initialize listeners for existing rows
        Array.from(tbody.rows).forEach(row=>attachRowListeners(row));
    </script>
</body>
</html>